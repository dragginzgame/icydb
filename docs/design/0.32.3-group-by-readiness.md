# 0.32.3 - GROUP BY Readiness Scaffolding

## Theme
Prepare grouped planner/executor boundaries for `0.33` integration without enabling public grouped runtime behavior in `0.32.x`.

## Dependency Chain
- Input from `0.32`: grouped substrate, grouped budget/context plumbing, deterministic grouped-key/equality foundations, grouped runtime still disabled.
- Output to `0.33`: lower-risk grouped enablement with pre-wired contracts, test coverage, and observability.

## Objectives
### 1. Internal Grouped Handoff Contract
Define one internal query->executor grouped handoff shape that captures:
- group fields
- grouped aggregate terminals
- grouped execution config

Requirements:
- keep this contract internal to `db`
- no public grouped API exposure
- no grouped runtime enablement in this milestone

Acceptance criteria:
- grouped planning inputs cross exactly one explicit internal boundary
- no duplicate grouped handoff structs in parallel modules

### 2. Grouped Error Mapping Scaffolding
Pre-wire grouped-domain error mapping into query/plan surfaces while grouped execution remains gated.

Requirements:
- mapping is explicit and typed
- grouped-disabled behavior remains unchanged

Acceptance criteria:
- grouped error conversions compile and are covered by tests
- grouped-disabled paths still reject grouped runtime execution

### 3. Determinism and Ordering Test Expansion
Add grouped-focused deterministic fixture coverage for:
- insertion-order variation
- hash-collision variation
- stable grouped output ordering

Acceptance criteria:
- new grouped determinism tables exist under executor/query grouped ownership
- tests prove output stability across permutations

### 4. Grouped Observability Schema Lock-In
Define grouped trace/metrics fields now, even if grouped runtime remains disabled.

Requirements:
- grouped route decision outcomes are representable
- grouped budget counters are representable
- grouped rejection reasons are representable

Acceptance criteria:
- grouped observability fields and explain/trace mapping contracts are test-covered

### 5. Grouped Compatibility Vectors
Add stable vector/snapshot tests for grouped intermediate/final encoding boundaries used by grouped planning/execution handoff.

Acceptance criteria:
- grouped vectors catch wire-shape drift before runtime enablement

### 6. Grouped Disabled-Path Guardrails
Strengthen tests that grouped intent remains non-executable in `0.32.x`.

Acceptance criteria:
- grouped execution cannot be reached through scalar/public runtime paths
- grouped-disabled behavior is explicit and assertion-backed

### 7. Ownership Boundary Clarification
Lock ownership in code/docs:
- grouped semantic validation belongs to query planning
- grouped runtime capability and execution policy belongs to executor

Acceptance criteria:
- no new cross-layer imports violating this split
- boundary comments/docs are present at module roots

## Out of Scope
- public grouped runtime execution enablement
- grouped cursor runtime semantics
- grouped public API/response surface (`execute_grouped`, grouped response variants)
- replacing route/public execution taxonomy in this milestone

## Risk and Rollback
| Area | Risk | Rollback |
| --- | --- | --- |
| Internal grouped handoff contract shape | Medium | Keep adapter shim at boundary and defer shape strictness to `0.33`. |
| Grouped error mapping scaffolding | Low-Medium | Keep mapping internal and route grouped-disabled errors through current fallback path. |
| Expanded deterministic test matrix | Low | Keep table fixtures minimal and scoped; remove non-essential combinatorics if maintenance burden grows. |
| Observability schema lock-in | Medium | Keep fields additive/internal and guard external surface until grouped enablement milestone. |

## Test Matrix
| Phase | Unit | Integration | Property | Upgrade |
| --- | --- | --- | --- | --- |
| Phase 1: handoff contract | grouped handoff shape tests | query->executor handoff wiring tests | shape-field completeness checks | N/A |
| Phase 2: error mapping | grouped error conversion tests | grouped-disabled rejection mapping tests | typed-domain mapping invariants | N/A |
| Phase 3: determinism | grouped key/order tests | grouped plan fixture execution tests | insertion/hash permutation stability | N/A |
| Phase 4: observability | grouped explain/trace mapping tests | route decision metrics tests | reason-domain coverage checks | N/A |
| Phase 5: disabled guardrails | grouped gate tests | public/scalar path rejection tests | grouped-unreachable invariants | N/A |

## Expected Result
After `0.32.3`, grouped runtime is still disabled, but `0.33` can focus on execution enablement rather than contract discovery and boundary cleanup.
