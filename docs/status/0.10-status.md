# 0.10 Status (as of 2026-02-16)

## 0.10 Scope

This status tracks progress against `docs/design/0.10-index-ordering.md` for the
`0.10.x` IndexKey v2 work.

`0.10.0` shipped the canonical ordered index-key layout and replay/rebuild
hardening. `0.10.1` and `0.10.2` focused on cleanup, DRY, and maintainability
of planning/execution surfaces around that model.

---

## Release Snapshot

- [x] `0.10.0` released: canonical framed index-key encoding, ordering, rebuild.
- [x] `0.10.1` released: follow-up macro/lint cleanup.
- [x] `0.10.2` released: DRY/structural cleanup (pushdown mapping, commit-window
  orchestration centralization, access-plan projection centralization, test
  simplification, and hot-path allocation cleanup).

Overall status for the 0.10 index-ordering contract: **100% complete**.

---

## Ordering Contract Alignment

### 1. Goals

1. Semantic ordering equivalence: **Done**
2. Lexicographic range traversal support: **Done**
3. Planner determinism: **Done**
4. Cursor continuation stability: **Done**
5. Remove fingerprint/hash ordering artifacts: **Done**
6. Reduce future drift risk: **Done**

### 2. Scope of Stability

- Internal storage/canister stability of IndexKey v2: **Done**
- Cursor continuation stability for canonical plan signatures/boundaries: **Done**
- Explicit statement on exposing raw index-key bytes as public protocol: **Done**
  - 0.10 docs now state continuation tokens are structured (`signature + boundary`)
    and do not expose raw index-key bytes as a public API surface.

### 3. Canonical Encoding Law

- Implemented and covered by canonical ordering tests and byte/semantic parity
  checks for supported indexable variants: **Done**
- Added randomized mixed-composite parity coverage for canonical ordering law:
  **Done**

### 4. IndexKey Structure

- Stable key tuple shape `(kind, index_id, components..., pk)` with framed
  segments: **Done**
- Explicit key-kind isolation (`User` vs `System`): **Done**
- Deterministic index_id handling and decode invariants: **Done**
- Decoder rejection on malformed/truncated/trailing bytes: **Done**

### 5. Ordering Semantics

- Composite left-to-right ordering with terminal PK tie-break: **Done**
- Float policy frozen in tests (`NaN` handling, `-0.0/+0.0` behavior): **Done**
- Enum and payload ordering deterministic: **Done**

### 6. Prefix Semantics

- Prefix bounds and scan isolation behavior validated in key-codec tests: **Done**
- Unique constraint checks via canonical indexable prefix semantics: **Done**

### 7. Cursor & Pagination Invariants

- Continuation signature and boundary validation in planning boundary: **Done**
- Strict monotonic paging behavior and parity tests (fast/non-fast paths): **Done**
- No duplicate/no-skip page boundary invariants covered by pagination tests: **Done**

### 8. Range Query Semantics

- Canonical key bounds and lexicographic traversal primitives are in place: **Done**
- Primary-key key-range path with ordered pagination semantics is covered: **Done**
- Broader secondary range operators (`>`, `>=`, `<`, `<=`, `BETWEEN`) as first-class
  query features remain outside 0.10 scope: **Not targeted**

### 9. Planner Contract

- Prefix planning uses canonical encodability checks: **Done**
- ORDER BY pushdown eligibility matrix exists and is validated/tested: **Done**
- Pushdown applicability/result mapping centralized across explain/trace/executor: **Done**
- Fingerprint heuristics are not used for ordering eligibility decisions: **Done**

### 10. Non-Goals

- Cost-based optimization, bitmap indexes, stats-based planning, and compression
  remain out of scope: **Unchanged (as intended)**

### 11. Mandatory Test Matrix

- Canonical ordering and golden-byte tests: **Done**
- Byte-vs-semantic parity tests: **Done**
- Prefix-bound and cross-index isolation tests: **Done**
- Cursor continuation and parity tests: **Done**
- Fuzz/corruption decode tests for key codecs: **Done**
- Additional randomized/property density across more mixed composite cases:
  **Nice-to-have follow-up**

### 12. Pre-Implementation Checklist (retroactive)

1. Canonical value ordering defined: **Done**
2. Tag space defined/stable: **Done**
3. Float normalization policy frozen: **Done**
4. NaN behavior decided and tested: **Done**
5. index_id framing/width contract set: **Done**
6. PK canonical tie-break confirmed: **Done**
7. Raw key bytes public API decision: **Done**
8. Migration strategy documented/implemented: **Done**

### 13. Migration Considerations

- In-place replacement strategy (no dual-format compatibility mode): **Done**
- Startup rebuild/fail-closed recovery behavior implemented and tested: **Done**

### 14. Failure Modes Guarding

- Semantic-vs-byte drift: guarded by parity/golden tests.
- Prefix mismatch/scan bleed: guarded by prefix/cross-index tests.
- Cursor instability: guarded by signature/boundary validation and pagination parity tests.
- Variant-expansion drift risk: reduced via centralized value tags/projections and test coverage.

Status: **Done with strong guardrails**.

### 15. Architectural Freeze Clause

- Core encoding and ordering surfaces are treated as protocol-level behavior in
  0.10 docs/tests/changelog.
- Canonical freeze note is explicitly documented in
  `docs/design/0.10-index-ordering.md`.

Status: **Done**.

---

## 0.10.2 Maintainability Additions (Post-Ship Hardening)

- Centralized `AccessPlan` projection consumed by explain/trace/metrics/hash.
- Centralized plan-shape policy ownership in `query::policy`.
- Centralized commit-window orchestration for save/delete flows.
- Centralized pushdown surface projection for explain+trace.
- Centralized value tag usage across normalization/ordered/fingerprint paths.
- Reduced hot-path allocations in cursor filtering and predicate key framing.
- Split post-access execution into explicit phase helpers.
- Converted repeated pushdown tests to table-driven cases.

These changes do not alter 0.10 semantics; they reduce drift risk and maintenance cost.

---

## Post-0.10 Routine Maintenance (optional)

1. Continue extending table-driven coverage in pagination/pushdown suites as
   routine test hygiene.
