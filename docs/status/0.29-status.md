# 0.29 Status (as of 2026-02-24)

## 0.29 Scope

This status tracks pre-`GROUP BY` hardening from:

- `docs/design/0.29-hardening-before-group-by.md`

`0.29` is structural only.

---

## In Scope (`0.29.0`)

- centralize aggregate fast-path eligibility enforcement
- enforce canonical ranked-row helper usage for all `top/bottom k` terminal families
- harden query-shape to execution-mode ownership (explicit, centralized, closed)
- lock cursor signature invariants against terminal-shape drift
- complete determinism audit for ordering-sensitive paths
- expand commit/recovery failure-boundary parity coverage
- simplify duplicated enforcement surfaces without changing behavior
- harden planner/fold infrastructure boundaries for grouped-readiness
- confirm memory-pressure and scan-budget/underfill contracts before grouped accumulation

## Out of Scope (`0.29.0`)

- new terminals
- new aggregate families
- new routing modes
- cursor feature expansion
- pushdown experiments
- early top-k heap optimization
- `GROUP BY`

---

## Locked Baselines (`0.29`)

- [ ] Error taxonomy baseline re-validated (null/missing parity + fail-before-scan unchanged)
- [ ] Determinism baseline re-validated (pk tie-break + comparator contracts unchanged)
- [ ] Continuation baseline re-validated (ranked terminals remain non-paged; no cursor expansion)

---

## Release Snapshot (`0.29.0`)

- [ ] `0.29.0` released
- [x] Design doc created (`docs/design/0.29-hardening-before-group-by.md`)
- [ ] Milestone hardening tracker finalized
- [ ] Canonical aggregate fast-path eligibility gate implemented
- [ ] Mandatory callsite enforcement added for aggregate fast paths
- [ ] Aggregate fast-path eligibility is compiler-enforced where feasible (verified marker/token pattern)
- [ ] Ranked comparator logic fully routed through canonical ranked-row helpers
- [ ] Central execution-mode selector is explicit and authoritative for aggregate terminals
- [ ] Implicit fold-internal mode fallback paths removed or guarded
- [ ] Execution mode is fixed pre-fold-allocation and immutable for execution lifetime
- [ ] Materialized-only grouped-fold readiness contract is documented and test-locked pre-`0.30`
- [ ] Cursor terminal-shape signature lock tests added
- [ ] Cursor signature binding covers ordering spec, direction, and limit/window shape
- [ ] HashMap iteration determinism audit completed with ordering notes
- [ ] Order-irrelevant iteration paths are explicitly documented to prevent accidental coupling
- [ ] Forced access-shape ranking invariance matrix completed (`FullScan` + `IndexRange`, ASC/DESC)
- [ ] Randomized insertion-order determinism test added for ranked output invariance
- [ ] Commit/replay failure-injection parity matrix expanded
- [ ] Mixed-state failure injection covered (`index success`, `row failure`, rollback, no visible inconsistency)
- [ ] Replay-apply failure injection edge covered with no-half-state assertion
- [ ] Duplicate enforcement branches consolidated without behavior change
- [ ] Aggregate planner descriptor/spec boundaries consolidated for grouped-readiness
- [ ] Aggregate spec unification completed as all-or-nothing (no partial-dispatch hybrid)
- [ ] Execution layer consumes unified internal aggregate spec only (early terminal-to-spec translation)
- [ ] Fold-state container boundary supports grouped multi-state shape (internal-only, no behavior change)
- [ ] Memory-pressure/scan-budget/underfill contract audit completed for grouped-readiness
- [ ] Ranking-terminal memory semantics documented (materialization dependency + growth bound)
- [ ] Fold-state lifetime and row-reference retention boundaries documented
- [ ] Early top-k optimization explicitly deferred (no heap-streaming top-k path in `0.29`)
- [ ] Changelog entry added for `0.29.0`

Current `0.29.0` status: **planned / not started**.

---

## Phase Tracker

## Phase 1 - Aggregate Surface Hardening

- [ ] Fast-path eligibility centralization complete
- [ ] Eligibility bypass-prevention tests complete
- [ ] Eligibility entrypoint shape is mechanically enforced (verified marker/token or equivalent)
- [ ] Ranked helper enforcement complete
- [ ] Query-shape to execution-mode boundary hardening complete
- [ ] Execution mode immutability (pre-fold-allocation + no mid-run mutation) enforced
- [ ] Cursor signature lockdown tests complete
- [ ] Cursor signature bindings include ordering/direction/window-shape invariants

## Phase 2 - Determinism Audit

- [ ] HashMap iteration-order semantic audit complete
- [ ] Ordering relevance comments/assertions added at critical boundaries
- [ ] Order-irrelevant paths documented to avoid accidental BTree/Hash ordering coupling
- [ ] Global comparator invariance tests complete
- [ ] Randomized insertion-order ranked-output invariance test complete

## Phase 3 - Commit and Recovery Hardening

- [ ] Replay parity expansion complete
- [ ] Failure-injection no-half-state coverage complete
- [ ] Mixed-state failure edge coverage complete (`index success` + `row failure` + rollback)
- [ ] Replay-failure injection edge coverage complete

## Phase 4 - Surface Simplification

- [ ] Duplicate error mapping branches consolidated
- [ ] Redundant slot-resolution checks consolidated
- [ ] Mirrored comparator logic removed outside canonical helpers

## Phase 5 - Planner and Memory Readiness

- [ ] Planner aggregate descriptor/spec consolidation complete
- [ ] Aggregate spec unification is all-or-nothing and authoritative
- [ ] Terminal surfaces lower to internal aggregate spec early; no late terminal-branch aggregate dispatch
- [ ] Fold-state container boundary readiness complete
- [ ] Memory-pressure + scan-budget/underfill audit complete
- [ ] Ranking-terminal memory semantics documented (full materialization vs bounded growth contract)
- [ ] Fold-state lifetime + row-reference retention contracts documented
- [ ] Early top-k optimization deferral lock documented and verified

---

## 0.29 Exit Criteria

`0.29` is ready to close when:

1. one aggregate fast-path eligibility gate is authoritative
2. one ranked-row helper family is authoritative
3. cursor terminal-shape signature invariants are test-locked
4. determinism assumptions are explicit and enforced
5. commit/recovery failure boundaries are hardened by tests
6. planner/fold grouped-readiness boundaries are explicit and stable
7. memory-pressure and scan-budget/underfill contracts are explicitly locked pre-`GROUP BY`
8. early top-k optimization remains deferred in `0.29`
9. randomized insertion-order determinism test is green for ranked terminals
10. no new query features were shipped in this milestone

---

## Next Milestone

If the above is complete:

- start `0.30` `GROUP BY` implementation.
