# 0.29 Status (as of 2026-02-24)

## 0.29 Scope

This status tracks pre-`GROUP BY` hardening from:

- `docs/design/0.29-hardening-before-group-by.md`

`0.29` is structural only.

---

## In Scope (`0.29.0`)

- centralize aggregate fast-path eligibility enforcement
- enforce canonical ranked-row helper usage for all `top/bottom k` terminal families
- harden query-shape to execution-mode ownership (explicit, centralized, closed)
- lock cursor signature invariants against terminal-shape drift
- complete determinism audit for ordering-sensitive paths
- expand commit/recovery failure-boundary parity coverage
- simplify duplicated enforcement surfaces without changing behavior
- harden planner/fold infrastructure boundaries for grouped-readiness
- confirm memory-pressure and scan-budget/underfill contracts before grouped accumulation

## Out of Scope (`0.29.0`)

- new terminals
- new aggregate families
- new routing modes
- cursor feature expansion
- pushdown experiments
- early top-k heap optimization
- `GROUP BY`

---

## Locked Baselines (`0.29`)

- [x] Error taxonomy baseline re-validated (null/missing parity + fail-before-scan unchanged)
- [x] Determinism baseline re-validated (pk tie-break + comparator contracts unchanged)
- [x] Continuation baseline re-validated (ranked terminals remain non-paged; no cursor expansion)

---

## Release Snapshot (`0.29.0`)

- [ ] `0.29.0` released
- [x] Design doc created (`docs/design/0.29-hardening-before-group-by.md`)
- [x] Milestone hardening tracker finalized
- [x] Canonical aggregate fast-path eligibility gate implemented
- [x] Mandatory callsite enforcement added for aggregate fast paths
- [x] Aggregate fast-path eligibility is compiler-enforced where feasible (verified marker/token pattern)
- [x] Ranked comparator logic fully routed through canonical ranked-row helpers
- [x] Central execution-mode selector is explicit and authoritative for aggregate terminals
- [x] Implicit fold-internal mode fallback paths removed or guarded
- [x] Execution mode is fixed pre-fold-allocation and immutable for execution lifetime
- [x] Materialized-only grouped-fold readiness contract is documented and test-locked pre-`0.30`
- [x] Cursor terminal-shape signature lock tests added
- [x] Cursor signature binding covers ordering spec, direction, and limit/window shape
- [x] HashMap iteration determinism audit completed with ordering notes
- [x] Order-irrelevant iteration paths are explicitly documented to prevent accidental coupling
- [x] Forced access-shape ranking invariance matrix completed (`FullScan` + `IndexRange`, ASC/DESC)
- [x] Randomized insertion-order determinism test added for ranked output invariance
- [x] Commit/replay failure-injection parity matrix expanded
- [x] Mixed-state failure injection covered (`index success`, `row failure`, rollback, no visible inconsistency)
- [x] Replay-apply failure injection edge covered with no-half-state assertion
- [x] Duplicate enforcement branches consolidated without behavior change
- [x] Redundant slot-resolution checks consolidated without behavior change
- [x] Aggregate planner descriptor/spec boundaries consolidated for grouped-readiness
- [x] Aggregate spec unification completed as all-or-nothing (no partial-dispatch hybrid)
- [x] Execution layer consumes unified internal aggregate spec only (early terminal-to-spec translation)
- [x] Fold-state container boundary supports grouped multi-state shape (internal-only, no behavior change)
- [x] Memory-pressure/scan-budget/underfill contract audit completed for grouped-readiness
- [x] Ranking-terminal memory semantics documented (materialization dependency + growth bound)
- [x] Fold-state lifetime and row-reference retention boundaries documented
- [x] Early top-k optimization explicitly deferred (no heap-streaming top-k path in `0.29`)
- [x] Changelog entry added for `0.29.0`

Current `0.29.0` status: **in progress**.

Current first execution focus:

- Phase 5 complete; final 0.29 pre-release validation and baseline check closeout.

---

## Phase Tracker

## Phase 1 - Aggregate Surface Hardening

- [x] Fast-path eligibility centralization complete
- [x] Eligibility bypass-prevention tests complete
- [x] Eligibility entrypoint shape is mechanically enforced (verified marker/token or equivalent)
- [x] Ranked helper enforcement complete
- [x] Query-shape to execution-mode boundary hardening complete
- [x] Execution mode immutability (pre-fold-allocation + no mid-run mutation) enforced
- [x] Cursor signature lockdown tests complete
- [x] Cursor signature bindings include ordering/direction/window-shape invariants

## Phase 2 - Determinism Audit

- [x] HashMap iteration-order semantic audit complete
- [x] Ordering relevance comments/assertions added at critical boundaries
- [x] Order-irrelevant paths documented to avoid accidental BTree/Hash ordering coupling
- [x] Global comparator invariance tests complete
- [x] Randomized insertion-order ranked-output invariance test complete

## Phase 3 - Commit and Recovery Hardening

- [x] Replay parity expansion complete
- [x] Failure-injection no-half-state coverage complete
- [x] Mixed-state failure edge coverage complete (`index success` + `row failure` + rollback)
- [x] Replay-failure injection edge coverage complete

## Phase 4 - Surface Simplification

- [x] Duplicate error mapping branches consolidated
- [x] Redundant slot-resolution checks consolidated
- [x] Mirrored comparator logic removed outside canonical helpers

## Phase 5 - Planner and Memory Readiness

- [x] Planner aggregate descriptor/spec consolidation complete
- [x] Aggregate spec unification is all-or-nothing and authoritative
- [x] Terminal surfaces lower to internal aggregate spec early; no late terminal-branch aggregate dispatch
- [x] Fold-state container boundary readiness complete
- [x] Memory-pressure + scan-budget/underfill audit complete
- [x] Ranking-terminal memory semantics documented (full materialization vs bounded growth contract)
- [x] Fold-state lifetime + row-reference retention contracts documented
- [x] Early top-k optimization deferral lock documented and verified

---

## 0.29 Exit Criteria

`0.29` is ready to close when:

1. one aggregate fast-path eligibility gate is authoritative
2. one ranked-row helper family is authoritative
3. cursor terminal-shape signature invariants are test-locked
4. determinism assumptions are explicit and enforced
5. commit/recovery failure boundaries are hardened by tests
6. planner/fold grouped-readiness boundaries are explicit and stable
7. memory-pressure and scan-budget/underfill contracts are explicitly locked pre-`GROUP BY`
8. early top-k optimization remains deferred in `0.29`
9. randomized insertion-order determinism test is green for ranked terminals
10. no new query features were shipped in this milestone

---

## Next Milestone

If the above is complete:

- start `0.30` `GROUP BY` implementation.
