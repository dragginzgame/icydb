# 0.23 Status (as of 2026-02-21)

## 0.23 Scope

This status tracks decimal consolidation from:

- `docs/design/0.23-decimal-consolidation.md`

In scope for `0.23`:

- one owned runtime decimal engine (`Decimal { mantissa: i128, scale: u32 }`)
- collapse fixed-point runtime branching into a single decimal path
- delete `E8s` / `E18s` from schema/runtime surfaces
- add schema newtype wrappers for `E8s`/`E18s` fixed-scale compatibility
- remove all runtime reliance on `rust_decimal`
- enforce decimal scale at schema write boundaries

Out of scope for `0.23`:

- arbitrary-precision decimal math
- scientific notation parsing
- multiple rounding-mode families
- planner/cost-model redesign

---

## Release Snapshot

- [x] `0.23` milestone tracker created
- [x] `0.23` design doc rewritten into standard milestone format
- [x] schema pre-work landed for decimal scale declaration (`item(scale = N)`)
- [x] runtime field metadata carries required decimal scale (`FieldKind::Decimal { scale: u32 }`)
- [x] `Primitive::E8s` / `Primitive::E18s` removed from schema + derive surfaces
- [x] schema newtype wrappers landed for `E8s`/`E18s` compatibility
- [x] owned decimal arithmetic engine landed
- [x] `E8s`/`E18s` deleted from schema/runtime surfaces
- [x] zero runtime reliance on `rust_decimal` (dependency removed)
- [x] `Value` fixed-point variant collapse completed
- [x] write-time decimal scale enforcement finalized in save preflight
- [x] boundary regressions added for mixed-scale writes and decode-time rejection

Overall status: **in progress; decimal consolidation is complete and follow-up parity/doc tracking continues in `0.23.1+`**.

---

## Current Baseline

- Decimal scale can now be declared in schema macros with `item(prim = "Decimal", scale = N)`.
- Non-decimal primitives reject `scale` at derive validation time.
- Runtime model now carries required decimal scale metadata and no longer uses transitional optional scale.
- Schema primitives no longer include `E8s`/`E18s`; compatibility is wrapper-based.
- Base schema wrappers now exist for fixed-scale compatibility:
  - `base::types::finance::E8s` (`scale = 8`)
  - `base::types::finance::E18s` (`scale = 18`)
- Runtime numeric consolidation is now complete:
  - owned decimal implementation is active
  - `Value` fixed-point variants are collapsed to `Decimal`
  - `rust_decimal` dependency is removed

---

## Next Slice

1. Keep aggregate/predicate parity verification green as decimal-path changes land.
2. Ship `0.23.6` index-range aggregate direct-path hardening from:
   - `docs/design/0.23.6-indexrange-aggregate-direct-path.md`
3. Keep release docs/changelog aligned with decimal and aggregate patch-line behavior (`0.23.x`).

---

## Verification Run (this pass)

- `make fmt-check`
- `cargo test -p icydb-schema-tests test::validate::finance -- --nocapture`
- `cargo test -p icydb-core decimal_scale_mixed_writes_reject_noncanonical_scale -- --nocapture`
- `cargo test -p icydb-core save_update_rejects_persisted_row_with_decimal_scale_drift -- --nocapture`
- `cargo test -p icydb-core db::executor::mutation::save::tests -- --nocapture`
- `cargo test -p icydb-core decimal_serde_cbor_rejects_invalid_binary_scale -- --nocapture`
- `cargo test -p icydb-core db::query::predicate -- --nocapture`
- `cargo test -p icydb-core db::executor::tests::aggregate -- --nocapture`
- `cargo check --workspace`
