# 0.16 Status (as of 2026-02-19)

## 0.16 Scope

This status tracks progress against `docs/design/0.16-composite-union.md`
for the `0.16.x` composite access execution milestone.

In scope for `0.16`:

- `AccessPath::Union` composite execution
- Planner emission for eligible `OR` shapes
- Executor N-way ordered stream merge
- Duplicate suppression across child paths
- ASC/DESC parity
- LIMIT/continuation compatibility without semantic relocation

Out of scope for `0.16`:

- `Intersection` execution
- Public streaming API
- Async execution
- Cost-based planner selection
- LIMIT pushdown across union children
- Cursor ownership relocation

---

## Release Snapshot

- [ ] `0.16.0` not released
- [x] 0.15 stream baseline is in place (`OrderedKeyStream` + stream-backed load paths)
- [x] Planner already emits and normalizes `AccessPlan::Union` for `OR` shapes
- [x] Internal `MergeOrderedKeyStream` helper exists with focused unit coverage
- [x] Executor `Union` path now composes child streams with pairwise stream merge
- [x] Explicit merge-direction enforcement is wired for composite execution
- [ ] 0.16 union regression matrix is complete (partial coverage added)

Overall status for tracked 0.16 work: **74% complete**.

---

## 0.16 Plan Alignment (Composite Union)

### 1. Planner Surface

- Progress: **80%**
- Current state:
- `AccessPlan::Union` emission for `OR` shapes exists in planner code.
- Union normalization/flattening support exists in planner normalization logic.
- Remaining:
- Complete 0.16-specific eligibility lock-in tests for the final emission constraints in the design doc.

### 2. Executor Integration

- Progress: **75%**
- Current state:
- `AccessPlan::Union` now builds child `OrderedKeyStream`s and merges them pairwise into one canonical stream.
- Union merge construction now passes explicit direction into merge streams.
- `AccessPlan::Intersection` still resolves through candidate-key materialization (`collect_candidate_keys`) and remains out of scope for 0.16.
- Remaining:
- Expand integration coverage for edge-limit and continuation-heavy union plans.

### 3. Merge Primitive Readiness

- Progress: **95%**
- Current state:
- `MergeOrderedKeyStream` exists and covers ascending merge, descending merge, dedup, and error propagation in unit tests.
- Merge streams now reject per-child direction mismatches with `InvariantViolation`.
- Production `Union` execution now uses the merge primitive through pairwise stream composition.
- Remaining:
- Expand higher-level union pagination coverage around continuation/limit boundaries.

### 4. Invariant and Ownership Boundaries

- Progress: **70%**
- Current state:
- Continuation, limit/offset, boundary validation, predicate filtering, and row deserialization ownership remain outside stream layer, consistent with 0.15 non-relocation.
- Remaining:
- Add union integration tests proving no semantic relocation under composite execution.

### 5. Completion Criteria Check

- [x] Planner can emit `Union`
- [x] Executor supports N-way ordered merge for `Union`
- [x] Direction is enforced at merge construction for composite execution
- [ ] Regression matrix is green for continuation, DESC parity, LIMIT behavior, explain surface, and metrics surface

---

## Verification Run (this status pass)

- Static code audit via `rg` across planner/executor stream callsites.
- Confirmed planner-side `Union` emission exists.
- Confirmed `AccessPlan::Union` now builds merged stream composition in executor context path.
- Confirmed `AccessPlan::Intersection` remains materialized (out of scope for 0.16).
- `cargo check -p icydb-core --locked`
  - Result: pass
- `cargo test -p icydb-core db::executor::ordered_key_stream --locked`
  - Result: `7 passed; 0 failed`
- `cargo test -p icydb-core db::executor::tests::semantics --locked`
  - Result: `22 passed; 0 failed`
- `cargo test -p icydb-core db::executor::tests::semantics::load_union_desc_limit_continuation_has_no_duplicate_or_omission --locked`
  - Result: `1 passed; 0 failed`
- `cargo test -p icydb-core load_trace_marks_composite_index_range_pushdown_rejection_outcome --locked`
  - Result: `1 passed; 0 failed`

---

## Readout

- 0.16 composite execution is now partially implemented: `Union` runs through stream merge in executor paths.
- Direction ownership is now explicit in merge construction, and mismatched child ordering is rejected as an invariant violation.
- Added dedicated coverage for the high-risk `Union × DESC × LIMIT × Continuation` interaction.
- The major remaining work is broader union regression coverage across additional shape variants.
- Current baseline is safe: no semantic ownership moved into stream internals.

---

## Next Checkpoint

1. Add union test matrix coverage (disjoint, overlap, empty-child, LIMIT, DESC, error cases).
2. Re-run targeted executor and pagination regression suites.
3. Decide whether to keep `Intersection` materialized in 0.16 or defer fully to 0.17.
