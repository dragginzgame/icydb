# 0.21 Status (finalized 2026-02-20)

## 0.21 Scope

This status tracks cursor paging with full offset semantics from:

- `docs/design/0.21-cursor-offset.md`

In scope for `0.21`:

- allow `offset` in cursor paging flows
- apply offset exactly once across a cursor chain
- keep strict continuation semantics (no duplicate/skip from offset re-apply)
- keep continuation token compatibility rules explicit
- preserve storage format and query planner shape

Out of scope for `0.21`:

- snapshot isolation across pages
- cursor portability across schema/index changes
- planner redesign or cost-based route selection

---

## Release Snapshot

- [x] `0.21.0` released
- [x] Milestone tracker created
- [x] Continuation token v2 window payload (`initial_offset`) with v1 decode compatibility
- [x] Cursor offset compatibility validation (`ContinuationCursorWindowMismatch`)
- [x] Effective offset wired into pagination and scan-budget derivation paths
- [x] Cursor paging policy now allows offset (cursor still requires explicit order + limit)
- [x] Core offset-once correctness tests landed
- [x] Full ASC/DESC matrix closure for offset + continuation across fast-path and fallback shapes
- [x] Regression sweep re-run and green

Overall status: **complete; 0.21 cursor-offset scope shipped**.

---

## Completed In This Pass

### 1. Cursor Protocol Window State

- Added continuation token v2 support for `initial_offset`.
- Preserved v1 compatibility by decoding v1 as `initial_offset = 0`.
- Added explicit mismatch validation when token/query offset differs.

### 2. Canonical Cursor Compatibility Checks

- Centralized cursor compatibility checks in the cursor spine:
- signature match
- direction match
- window offset match

### 3. Runtime Offset-Once Semantics

- Added effective offset handling so continuation requests do not re-apply first-page offset.
- Applied effective offset to post-access pagination and fetch-budget calculations.

### 4. Baseline Planning/Boundary Cleanup

- Reduced duplicate boundary comparison wiring in logical ordering/boundary helpers.
- Split planner index-range candidate extraction into explicit classification/materialization phases.

---

## Post-0.21 Follow-Up (0.21.1 Cleanup)

1. Continue cleanup-only consolidation of repeated internal error constructors.
2. Keep trimming repeated pagination test wiring through shared helpers.
3. Keep docs/changelog aligned with shipped behavior after each cleanup pass.

## Exit Criteria (Shipped)

- Cursor paging with offset behaves as first-window displacement only.
- Continuation mismatches on offset are rejected deterministically.
- ASC/DESC + path-shape matrix is complete and green.
- `0.21.0` changelog entry reflects shipped behavior (no speculative items).
