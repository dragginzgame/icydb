# 0.17 Status (as of 2026-02-19)

## 0.17 Scope

This status tracks progress against `docs/design/0.17-intersection-streaming.md`
for the `0.17.x` composite streaming completion milestone.

In scope for `0.17`:

- Add `IntersectOrderedKeyStream<A, B>`
- Replace `AccessPlan::Intersection` candidate-set materialization with streaming
- Preserve deterministic ASC/DESC ordering and monotonic invariants
- Preserve continuation correctness and existing error classification
- Keep public API, storage format, index encoding, and cursor token format unchanged

Out of scope for `0.17`:

- Planner redesign
- New public streaming API
- Cost-based optimizer
- Composite LIMIT pushdown
- Cursor token format changes

---

## Release Snapshot

- [ ] `0.17.0` not released
- [x] 0.15 stream abstraction baseline exists (`OrderedKeyStream`, stream-backed load paths)
- [x] 0.16 composite union streaming exists (pairwise `MergeOrderedKeyStream` in executor path)
- [x] `IntersectOrderedKeyStream` exists
- [x] `AccessPlan::Intersection` executes as pairwise stream intersection
- [x] `collect_candidate_keys` removed from intersection execution path
- [x] Composite executor path is free of materialized `BTreeSet` intersection logic
- [x] Current regression baseline remains green

Overall status for tracked 0.17 work: **100% complete (implementation + icydb-core validation)**.

---

## 0.17 Plan Alignment (Intersection Streaming)

### 1. Preconditions and Baseline

- Progress: **100%**
- Current state:
- Stream contract is established (`OrderedKeyStream` + `VecOrderedKeyStream`).
- Pairwise composite stream reduction is established for `Union`.
- Direction ownership and monotonic checks are implemented in stream logic.

### 2. Intersection Stream Primitive (`IntersectOrderedKeyStream`)

- Progress: **100%**
- Current state:
- `IntersectOrderedKeyStream<A, B>` is implemented in `db::executor::ordered_key_stream`.
- ASC/DESC intersection semantics are validated.
- Monotonic violation handling is enforced as invariant failure.
- Duplicate suppression is validated for one-sided and both-sided duplicate inputs.

### 3. Executor Integration (`AccessPlan::Intersection`)

- Progress: **100%**
- Current state:
- `AccessPlan::produce_key_stream` routes `Intersection` through pairwise stream reduction.
- Materialized candidate-set intersection logic has been removed from the execution path.
- Composite execution no longer relies on set-based intersection materialization.

### 4. Invariant and Behavior Preservation

- Progress: **100%**
- Current state:
- Intersection stream primitive tests cover ASC, DESC, no-overlap, duplicate suppression,
  both-side duplicate suppression, upstream error propagation, direction mismatch, and
  non-monotonic child sequence failure.
- Executor semantics tests cover intersection ASC/DESC behavior, no-overlap, duplicate
  suppression, nested composite execution, and DESC+LIMIT+continuation regression.
- Existing pagination and semantics suites remain green with streaming intersection enabled.

### 5. 0.17 Completion Criteria Check

- [x] No `collect_candidate_keys` usage for `Intersection`
- [x] All composite intersection execution is stream-native (no set materialization)
- [x] No materialized `BTreeSet` in composite intersection executor path
- [x] Existing regression baseline passes
- [x] New intersection streaming test matrix passes
- [x] No explain/metrics regressions observed in `icydb-core` test suite
- [x] `cargo test -p icydb-core --locked` passes

---

## Verification Run (this status pass)

- `cargo check -p icydb-core --locked`
  - Result: pass
- `cargo test -p icydb-core db::executor::ordered_key_stream -- --nocapture`
  - Result: `15 passed; 0 failed`
- `cargo test -p icydb-core db::executor::tests::semantics -- --nocapture`
  - Result: `29 passed; 0 failed`
- `cargo test -p icydb-core db::executor::tests::pagination -- --nocapture`
  - Result: `55 passed; 0 failed`
- `cargo test -p icydb-core --locked`
  - Result: `583 passed; 0 failed` (+ compile-fail suite `1 passed`)

---

## Readout

- 0.17 intersection streaming implementation is complete in `icydb-core`.
- `Intersection` execution now matches the stream-native composite architecture.
- Required regression coverage for intersection execution and cursor behavior is in place and green.
- Optional cleanup to simplify merge lookahead state (single-item lookahead vs `VecDeque`) is also complete.

---

## Next Checkpoint

1. Run full workspace gate (`make check && make clippy && make test`) for release confidence.
2. Update release notes/changelog for 0.17 packaging.
3. Cut `0.17.0` once workspace gate and release artifacts are complete.
