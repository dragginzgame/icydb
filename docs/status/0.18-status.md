# 0.18 Status (as of 2026-02-19)

## 0.18 Scope

This status is now the single tracker for:

- execution scan budgeting (`offset + limit + 1` guarded path)
- composite pagination correctness contract (formerly tracked as 0.19)

In scope for `0.18`:

- Guarded internal scan budgeting in load execution
- Deterministic composite pagination semantics for `Union` and `Intersection`
- Single-anchor continuation semantics for composite plans
- No-dup/no-omission/stable-order guarantees across ASC/DESC continuation paths
- Budgeted-vs-fallback continuation parity on safe shapes

Out of scope for `0.18`:

- Planner redesign or cost-based branch reordering
- Cursor token format changes
- Storage/index encoding changes
- Per-stream cursor anchors for composite continuation

---

## Release Snapshot

- [ ] `0.18.0` not released
- [x] 0.17 composite streaming baseline complete (`Union` + `Intersection` stream-native)
- [x] Guarded scan budget derivation/wrapping integrated at executor boundary
- [x] Plan-surface budget safety metadata is wired and used by executor
- [x] Composite single-anchor continuation semantics are implemented
- [x] DESC continuation and boundary monotonicity coverage exists
- [x] Budgeted/fallback continuation boundary parity coverage exists
- [ ] Explicit composite subplan permutation-invariance suite not yet present

Overall status: implementation-complete for scan budgeting; one explicit pagination-invariant test family remains for full combined 0.18 closure.

---

## Plan Alignment (Combined 0.18)

### 1. Execution Scan Budgeting

- Progress: **100%**
- Current state:
- `derive_scan_budget(plan, cursor)` implemented with safe-shape gating.
- `BudgetedOrderedKeyStream` implemented and boundary-integrated at `LoadExecutor::materialize_key_stream_into_page`.
- Budgeting is not applied inside access-path producers or composite stream constructors.

### 2. Composite Pagination Contract

- Progress: **near-complete**
- Current state:
- Single-anchor continuation behavior is active and covered for composite paths.
- Composite pagination/cursor tests cover no-dup/no-omission behavior under DESC continuation scenarios.
- Budgeted and fallback paths are covered for continuation boundary parity.
- Remaining:
- Add one explicit permutation-invariance suite that reorders composite child plans and asserts identical row sequence/page boundaries/continuation behavior.

### 3. Budgeting x Pagination Interaction

- Progress: **100% on implemented matrix**
- Current state:
- Composite pagination behavior is parity-checked between budgeted and non-budgeted execution for covered shapes.
- Continuation boundary computation remains stable for these paths.

---

## Combined 0.18 Completion Criteria Check

- [x] `derive_scan_budget(plan, cursor) -> Option<usize>` implemented
- [x] conservative budget-safe shape guard is implemented
- [x] budget wrapper integrated only at stream-consumption boundary
- [x] fallback behavior unchanged when budget is not applied
- [x] continuation parity proven for budgeted vs non-budgeted paths
- [x] composite continuation uses single-anchor semantics
- [ ] explicit permutation-invariance suite for composite child-order reordering
- [x] full existing test suite remains green

---

## Verification Run (this status pass)

- Static audit:
  - `rg -n "BudgetSafetyMetadata|budget_safety_metadata|derive_scan_budget|is_budget_safe_shape" crates/icydb-core/src/db/query/plan/logical.rs crates/icydb-core/src/db/executor/load/mod.rs`
  - `rg -n "materialize_key_stream_into_page|rows_from_ordered_key_stream|BudgetedOrderedKeyStream" crates/icydb-core/src/db/executor/load/mod.rs crates/icydb-core/src/db/executor/context.rs crates/icydb-core/src/db/executor/ordered_key_stream.rs`
  - `rg -n "no_duplicate_or_omission|equivalent_continuation_boundary|anchor_is_strictly_monotonic" crates/icydb-core/src/db/executor/tests/pagination.rs crates/icydb-core/src/db/executor/tests/semantics.rs`
  - `rg -n "Permutation|permutation|permute|subplan.*order|child order" crates/icydb-core/src/db/executor/tests/pagination.rs crates/icydb-core/src/db/executor/tests/semantics.rs crates/icydb-core/src/db/query/plan/validate/tests.rs`

- Focused tests run:
  - `cargo test -p icydb-core load_union_three_children_desc_limit_continuation_has_no_duplicate_or_omission --locked` (pass)
  - `cargo test -p icydb-core load_intersection_desc_limit_continuation_has_no_duplicate_or_omission --locked` (pass)
  - `cargo test -p icydb-core load_composite_budgeted_and_fallback_paths_emit_equivalent_continuation_boundary --locked` (pass)
  - `cargo test -p icydb-core load_composite_range_cursor_pagination_matches_unbounded_and_anchor_is_strictly_monotonic --locked` (pass)

---

## Readout

- 0.18 now includes both execution scan budgeting and composite pagination correctness tracking.
- The previous 0.19 tracking split has been removed at the milestone level.
- Remaining closure item is concrete and isolated: explicit child-order permutation invariance tests.

---

## Next Checkpoint

1. Add explicit permutation-invariance tests for `Union` and `Intersection` child order.
2. Re-run `cargo test -p icydb-core --locked`.
3. Mark combined 0.18 complete once that suite is green.
