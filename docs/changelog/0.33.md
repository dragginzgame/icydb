# IcyDB 0.33

This document aggregates detailed release notes for the `0.33.x` minor line.

---

## 0.33.3 - 2026-02-28 - Load Terminal Dispatch Consolidation and Commit Recovery Hardening

### üìù Summary

0.33.3 reduces structural growth pressure in the session layer by collapsing thin load-terminal wrappers into one shared session execution primitive while preserving terminal behavior and fluent-call ergonomics. It also hardens grouped correctness contracts and commit-marker recovery through stricter continuation-signature boundaries, grouped limit enforcement alignment, and replay/index-rebuild compatibility checks.

### üîß Changed - Load Terminal Dispatch

- Removed the large set of one-method-per-terminal load wrappers from the session layer and kept one shared load-query execution helper as the execution boundary.
- Moved terminal-specific operation dispatch to the fluent load query terminals, where each terminal now supplies its executor closure directly through the shared execution helper.
- Preserved metrics wiring, plan construction, and query-error mapping behavior by continuing to route all terminals through the same session-owned execution primitive.

### üîß Changed - Commit Recovery

- Added a commit schema fingerprint on marker row operations and enforced replay-time compatibility checks so marker replay fails closed when runtime schema/index contracts drift.
- Updated recovery ordering to clear the persisted marker only after secondary-index rebuild succeeds, so rebuild failures keep marker authority for retry.
- Split prepared-op application semantics so recovery replay now applies row mutations only, while secondary indexes are rebuilt once from authoritative row state.
- Added a replay-specific row-only rollback snapshot path so recovery rollback scope matches recovery apply scope.
- Annotated forward and reverse index mutations with typed delta kinds and derived commit-window mutation summaries from those annotations.
- Simplified commit-memory owner resolution to select the first matching registry range owner under the non-overlap registry contract.

### üîß Changed - Grouped Correctness Hardening

- Made grouped continuation signatures shape-aware so grouped query shape changes (group keys, aggregate terminals, and grouped limits) always produce distinct continuation signatures.
- Added explicit grouped projection/signature domain separation to prevent scalar and grouped continuation signatures from colliding.
- Removed query-side predicate reconstruction from fingerprinting so continuation/fingerprint hashing now delegates directly to the canonical predicate-domain structural hash model.
- Removed scalar panic-style cursor dereferencing from load execution wrappers so scalar/grouped continuation handling is now explicit at call sites.
- Enforced grouped field-target aggregate rejection at planning boundaries so validated grouped plans no longer defer this mismatch to runtime execution errors.
- Unified scalar and grouped ingest/finalize reducer entry points under one aggregate engine contract while preserving grouped materialized execution shape.
- Corrected grouped `max_groups` enforcement semantics to count unique canonical group keys across grouped states, while keeping aggregate-state counters separate.

### üîß Changed - Predicate Domain Boundary

- Completed predicate spine convergence under `db::predicate` by moving active predicate runtime execution (`PredicateProgram`), normalization, enum-literal normalization, and schema-level predicate validation into the predicate domain.
- Moved predicate structural hashing ownership into `db::predicate` and updated continuation/fingerprint hashing to consume predicate-domain hashing helpers while preserving existing compare/coercion tag contracts.
- Rewired executor post-access filtering and preparation paths to import predicate runtime from `db::predicate` directly, removing the executor dependency on `query::predicate`.
- Rewired query `expr`/`intent`/`plan`/`explain` call sites to consume predicate normalize/validate APIs from `db::predicate`, and removed active `query::predicate` module wiring from `db::query` ownership.
- Removed the dormant `db/query/predicate/*` implementation tree after boundary rewiring so only `db::predicate` remains as the active predicate semantic spine.
- Kept coercion/comparison logic local to predicate semantics (`CoercionId`, `CoercionSpec`, coercion-rule routing, and compare helpers) instead of promoting a standalone cross-domain coercion module.
- Retained contracts-layer predicate re-exports as test-compatibility shims only.

### üîß Changed - Access Canonicalization Authority

- Moved deterministic access-plan/value-key canonicalization ownership into `db::access` so planner-side normalization and key canonicalization consume one domain-owned implementation.
- Added an access-owned canonical comparator surface (`canonical_form`) for `AccessPlan<Value>` and routed composite canonical sorting through that access-owned shape contract.
- Removed the duplicate canonicalization module under query fingerprint internals after moving tests and behavior coverage to the new access-owned canonicalization boundary.

### üß≠ Migration Notes

- Public fluent load terminal methods and return contracts are unchanged.
- This release is expected to be behavior-preserving and focused on internal API-surface consolidation for maintainability.
- Newly persisted markers include a schema fingerprint; legacy markers without one remain replayable.
- Recovery behavior is stricter under schema drift and may now reject incompatible pending markers instead of attempting planner re-derivation.
- Grouped continuation cursors are now stricter against query-shape drift, and grouped resume with mismatched shape tokens is rejected earlier.
- Public predicate builder/query APIs remain stable, but predicate internal ownership moved to `db::predicate`; internal consumers should treat contracts-layer predicate symbols as compatibility-only.

### üß™ Testing

- Split the aggregate executor parity suite into focused matrix modules while preserving terminal-parity coverage across session and executor entry paths.
- Added recovery coverage that rejects marker replay on schema-fingerprint mismatch and keeps marker state persisted for retry.
- Expanded startup recovery assertions to require marker persistence when rebuild fails closed.
- Updated invariant-check runtime anchors to follow the predicate runtime ownership move so field-projection invariant gates continue to validate the live predicate execution surface after `query::predicate` removal.

---

## 0.33.2 - 2026-02-28 - Grouped Runtime Activation and Stream Ownership Cleanup

### üìù Summary

0.33.2 completes grouped query runtime activation while continuing the `db/` structural compression program. The release finalizes grouped execution flow, grouped cursor resume wiring, and stream ownership boundaries without redesigning the existing query-to-executor architecture.

### üîß Changed - Grouped Vertical Slice Activation

- Activated grouped execution in load runtime so grouped plans are executed rather than rejected through temporary unsupported paths.
- Wired grouped aggregation state accumulation and finalization into grouped page materialization.
- Extended session execution and response plumbing so grouped queries can execute through the public session surface.

### üîß Changed - Cursor and Resume Wiring

- Connected grouped continuation token decode, validation, and preparation into grouped load entry paths.
- Enforced grouped resume revalidation so resumed execution continues strictly after the last emitted grouped boundary.
- Unified pagination response handling to support both scalar and grouped cursor payloads under one response contract.

### üîß Changed - Route and Observability Alignment

- Corrected grouped route observability to report real grouped route outcomes (selected, rejected, materialized fallback) and rejection reasons.
- Removed stale grouped-disabled diagnostics that no longer matched runtime behavior.

### üîß Changed - Structural Compression

- Moved thin traversal helpers under executor ownership to keep physical traversal policy local to execution.
- Collapsed thin grouped planning relay modules so grouped handoff contracts are owned directly by query planning modules.
- Flattened grouped cursor scaffolding so grouped token and planned cursor contracts remain with their primary cursor owners.

### üîß Changed - Stream Subsystem Ownership

- Moved the production DISTINCT stream adapter into the executor stream subsystem so production stream traits and implementations are co-located.
- Kept kernel focused on stream decoration/orchestration while consuming stream implementations from the stream subsystem.
- Preserved test-only stream mocks in test modules.

### üîß Changed - Contracts and Boundaries

- Introduced neutral resolved-predicate contracts to prevent index compilation from depending on query-runtime internals.
- Preserved layer direction and executor/query contract boundaries while relocating ownership.

### üß≠ Migration Notes

- Grouped queries are now executable through the session surface and return grouped continuation cursors.
- Cursor wire formats and aggregate semantics remain unchanged.
- This release is expected to be behavior-preserving for scalar query flows.

### üß™ Testing

- Re-ran workspace checks and tests to validate grouped-runtime wiring and structural moves.
- Compile-fail grouped session-missing guards were removed because grouped session execution is now available by design.
- Clippy execution may require an environment that supports hard-link operations for incremental artifacts.

---

## 0.33.0 - 2026-02-27 - Grouped Plan Activation

### üìù Summary

0.33.0 advances GROUP BY integration by hardening planner-level separation between scalar and grouped intent, tightening grouped execution boundaries, and normalizing governance/audit contracts used to track architectural drift.

### üîß Changed - Architectural Changes

- Introduced a strict logical-plan split where grouped intent is represented as a dedicated grouped variant rather than an optional scalar-plan extension.
- Removed the temporary grouped wrapper plan carrier and consolidated grouped metadata flow through the canonical access-planned query model.
- Normalized audit governance structure into recurring domain ownership (`planner`, `executor`, `cursor`, `access`, `storage`, `invariants`, `contracts`) plus crosscutting and oneoff tracks.
- Migrated historical audit material into the normalized audit hierarchy while preserving append-only history.

### üîß Changed - Execution Changes

- Executor entry points now pattern-match scalar and grouped logical plans explicitly.
- Grouped logical plans are routed through an explicit grouped-not-enabled path instead of implicit scalar fallback behavior.
- Grouped handoff wiring and route-planning integration now consume grouped plan metadata directly from the canonical planned-query boundary.

### üîß Changed - Validation and Invariants

- Group-query validation now validates grouped semantics against grouped logical-plan state instead of wrapper-only carriers.
- Planner and executor boundaries now enforce a stricter invariant: grouped semantics must remain type-level and must not be represented as transient scalar plan state.
- Audit governance now requires domain-owned recurring audits and day-grouped report retention to preserve invariant telemetry continuity.

### üîß Changed - Error Model Changes

- Added grouped-plan-required validation signaling for paths that attempt grouped validation without grouped logical-plan state.
- Preserved explicit grouped unsupported execution rejection during gated runtime phases to avoid silent fallback semantics.

### üß≠ Migration Notes

- This release changes internal planning and execution contracts around grouped intent; downstream integrations relying on internal plan carriers must align to the grouped logical-plan variant boundary.
- Grouped runtime execution remains intentionally gated; grouped plan construction and validation are activated ahead of runtime enablement.
- Audit and governance documentation paths are normalized; automation should use the new audit hierarchy and day-grouped reports convention.

### üß™ Testing

- Expanded grouped route/planner contract coverage for grouped logical-plan transport and handoff consistency.
- Expanded grouped validation coverage around grouped-plan-required enforcement and grouped semantic rejection boundaries.
- Retained compile-fail and boundary tests that ensure grouped internals remain non-public and grouped runtime APIs stay gated until full enablement.
- Re-ran core crate tests to confirm grouped planning contract changes preserve scalar-path behavior while grouped runtime remains blocked.
