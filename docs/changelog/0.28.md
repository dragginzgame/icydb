# IcyDB 0.28

This document aggregates detailed release notes for the `0.28.x` minor line.

---

## 0.28.6 - 2026-02-24 - TOP/BOTTOM K With Id Projection

### üìù Summary

* Adds ranked id/value projection terminals so callers can fetch top/bottom `k` field values with row ids in one call.

### ‚ûï Added

* Added `top_k_by_with_ids("field", k)` with deterministic `(field desc, primary_key asc)` ranking over the effective execute window.
* Added `bottom_k_by_with_ids("field", k)` with deterministic `(field asc, primary_key asc)` ranking over the effective execute window.
* Kept execution semantics terminal-only: canonical execution first, ranking second, projection last, with no routing or cursor model changes.

### üß™ Testing

* Added parity coverage vs `top_k_by`/`bottom_k_by` id/value projection, ASC/DESC direction invariance, null/missing-field error parity, `k = 1` extrema-projection equivalence, and `k = 0` empty-result contracts.
* Added non-paged cursor-intent guard coverage for `top_k_by_with_ids` and `bottom_k_by_with_ids`.

---

## 0.28.5 - 2026-02-24 - TOP/BOTTOM K Value Projection

### üìù Summary

* Adds ranked value-projection terminals so callers can fetch top/bottom `k` field values directly without manual row projection.

### ‚ûï Added

* Added `top_k_by_values("field", k)` with deterministic `(field desc, primary_key asc)` ranking over the effective execute window.
* Added `bottom_k_by_values("field", k)` with deterministic `(field asc, primary_key asc)` ranking over the effective execute window.
* Kept execution semantics terminal-only: canonical execution first, ranking second, projection last, with no routing or cursor model changes.

### üß™ Testing

* Added parity coverage vs `top_k_by`/`bottom_k_by` projection, ASC/DESC direction invariance, null/missing-field error parity, `k = 1` extrema-projection equivalence, and `k = 0` empty-result contracts.

---

## 0.28.4 - 2026-02-24 - BOTTOM_K_BY

### üìù Summary

* Adds deterministic bottom-k row selection and rounds out top/bottom terminal parity.

### ‚ûï Added

* Added `bottom_k_by("field", k)` as the ascending counterpart to `top_k_by`, with deterministic `(field asc, primary_key asc)` ordering.
* Kept terminal semantics aligned with canonical execution: top/bottom ranking is applied over the effective response window.
* Documented `k = 1` equivalence for row terminals with existing `max_by(field)` / `min_by(field)` selection semantics.

### üß™ Testing

* Added parity coverage for `bottom_k_by` ordering, ASC/DESC direction invariance, null/missing-field behavior, and bounded-window scan-budget semantics.

---

## 0.28.3 - 2026-02-24 - TOP_K_BY and TAKE

### üìù Summary

* Adds deterministic top-k query terminals with low semantic risk and clear practical utility.

### ‚ûï Added

* Added `top_k_by("field", k)` and `take(k)` terminals that operate on canonical ordered execution and return deterministic results.
* Kept semantics simple: ordered stream selection first, then effective window trimming, then terminal materialization/reduction.
* This release intentionally avoids new continuation behavior; cursor semantics remain unchanged.

---

## 0.28.2 - 2026-02-24

### üìù Summary

* Tightens DB layering boundaries and continuation-cursor invariants without changing query behavior.

### üîß Changed

* Split load aggregate internals into focused modules and moved aggregate field semantics under `executor/aggregate`.
* Moved route fast-path guards into `executor/route/guard` so route invariants remain route-owned.
* Removed index-to-query ownership leaks by moving `KeyEnvelope` and index predicate execution ownership to `db/index`.
* Unified strict continuation advancement checks behind shared comparator helpers used by both raw-key and logical boundary paths.
* Added canonical round-trip validation for index-range continuation anchors to fail closed on malformed token shape drift.
* `count_distinct_by("field")` now uses a streaming fold on fast-path shapes, reducing memory use while preserving canonical filtering, effective-window, and retry semantics.

### üß™ Testing

* Added parity coverage that `count_distinct_by` matches `execute()` for residual-retry index-range shapes and keeps scan-budget parity.
* Added coverage that `count_distinct_by` is direction-invariant and preserves current null/type mismatch behavior across ASC and DESC traversal.

---

## 0.28.1 - 2026-02-24 - Distinct Projection Follow-Up

### üìù Summary

* Adds value-level distinct projection as a follow-up to `values_by`, while keeping load routing and execution semantics unchanged.

### üîß Changed

* Added `distinct_values_by("field")` on load queries, returning first-observed distinct values from the effective result window.
* Added `values_by_with_ids("field")` so callers can get stable `(Id, Value)` projection pairs without manual re-zipping.
* Added `first_value_by("field")` and `last_value_by("field")` terminal helpers for single-value projection in effective response order.
* Kept query-level `DISTINCT` semantics row-level; `distinct_values_by` performs value-level deduplication as a terminal reduction step.
* Locked ordering semantics for `distinct_values_by`: output preserves first-observed value order from the effective response window.
* Reused the canonical load execution path and post-selection projection boundary (no new route branches, no projection pushdown changes).
* Unknown projection fields fail with typed `Unsupported` errors before scan work begins.

### üß™ Testing

* Added parity tests that `distinct_values_by("rank")` matches distinct projection derived from `execute()`.
* Added parity tests for `values_by_with_ids`, `first_value_by`, and `last_value_by` against `execute()` projection baselines.
* Extended unknown-field fail-before-scan coverage for `distinct_values_by`, `values_by_with_ids`, `first_value_by`, and `last_value_by`.
* Added scan-budget parity coverage for `distinct_values_by` and `values_by_with_ids` versus `execute()`.

---

## 0.28.0 - 2026-02-24 - Field Value Projection

### üìù Summary

* Adds a new load terminal for field-value projection so callers can fetch one field across the effective result window without manual row mapping.

### üîß Changed

* Added `values_by("field")` on load queries, returning `Vec<Value>` in effective response order.
* `values_by` runs after canonical row selection (post-access filtering, row-level `DISTINCT`, and page-window application) and reuses the existing load execution pipeline.
* Unknown projection fields fail with typed `Unsupported` errors before scan work begins.
* `0.28.0` intentionally keeps projection scope structural: no typed projection signatures, no value-level distinct terminal, and no projection pushdown or partial-row decode changes.

### üß™ Testing

* Added parity tests that `values_by("rank")` matches `execute()` projection mapping.
* Added regression coverage for row-level `DISTINCT` behavior, unknown-field fail-before-scan, and scan-budget parity versus `execute()`.
