# IcyDB 0.30

This document aggregates detailed release notes for the `0.30.x` minor line.

---

## 0.30.17 - 2026-02-27 - Last of the db/ Audits

Pre-`GROUP BY` cleanup release focused on reducing drift and duplication in `db/`.

### üìù Summary

* Final pre-`GROUP BY` audit cleanup pass to reduce policy drift and duplicated execution helpers.

### üîß Changed

* Unified secondary `ORDER BY` pushdown eligibility behind one shared implementation to prevent planner/route drift.
* Consolidated scan-direction and pagination keep-count helpers so cursor and executor paths now use the same policy functions.
* Simplified mutation commit-window orchestration by adding shared save/delete commit helpers and removing repeated wiring.

### üìö Documentation

* Reformatted the `0.31`/`0.32`/`0.33` design docs for clearer structure and easier review.

---

## 0.30.16 - 2026-02-27 - Pre-GROUP BY Kernel Consolidation

### üìù Summary

* Continued the pre-`GROUP BY` structural cleanup in `db/` to reduce execution-path duplication and tighten module boundaries.
* Kept grouped runtime behavior disabled while isolating grouped scaffolding behind explicit query/cursor/executor boundaries.

### üîß Changed - Execution Paths

* Consolidated route-owned direction/window/fast-path flow so load and aggregate paths now share one verified route-dispatch contract.
* Reduced duplication in mutation and session aggregate paths by centralizing commit-window sequencing and terminal-wrapper execution helpers.
* Re-centered cursor ordering/continuation helpers under `db::cursor`, with `post_access` using a dedicated order bridge for stable call sites.

### üîß Changed - Boundaries

* Added explicit grouped scaffold boundaries at `db::query::grouped`, `db::cursor::grouped`, and `db::executor::grouped`, with WIP ownership notes to keep grouped work isolated.
* Added a neutral `db::plan` contract surface for execution-relevant plan contracts and shared direction derivation.
* Moved query-side `plan()` entry wiring to an executor-owned adapter (`db::executor::query_plan`) and kept grouped support additive-only (no grouped execution enablement yet).

### üßπ Cleanup

* Removed low-value indirection wrappers in load/route/index boundaries and cleaned up stale dead-code expectations while preserving intentional grouped hooks under explicit `#[allow(dead_code)]` markers.
* Fixed invariant guard drift by restoring the required runtime projection file (`kernel/post_access/order_cursor.rs`) and keeping executor index-predicate compilation free of `encode*` runtime symbols.

### üìä Audit

* Audit footprint: updated 51 `db/` files (~915 insertions, ~918 deletions), added 7 new `db` modules for grouped/plan/cursor/query-plan boundaries, restored 1 required runtime compatibility file, and removed 4 pure-indirection wrappers.

---

## 0.30.15 - 2026-02-27 - GROUP BY Audit Scaffolding

### üìù Summary

* Added GROUP BY readiness scaffolding across query planning, route taxonomy, and cursor continuation types to reduce future integration churn.
* This release is substrate-only: grouped execution is still unsupported, and existing non-group/scalar aggregate runtime behavior is unchanged.

---

## 0.30.14 - 2026-02-27 - DB Entropy Reduction

### üìù Summary

* This release reduces structural entropy in `db/` and tightens test ownership boundaries.
* No production behavior change is intended; changes are ownership and layout cleanup only.

### üßπ Cleanup

* Reduced internal DB structure noise by removing pass-through wrappers and routing-only shims where behavior was unchanged.

### üìä Audit

* Consolidated aggregate execution into one canonical `db::executor::aggregate` root and removed the old split aggregate trees.
* Collapsed route-planner structure so route capability, mode, hints, and fast-path logic now live under one route namespace.
* Flattened query planning/validation ownership into `query/plan.rs` and `query/plan_validate.rs` and removed fragmented planner/validate trees.
* Unified cursor invariants under `db::cursor` and removed duplicate cursor ownership in executor paths.
* Reduced duplicate predicate roots by keeping shared predicate contracts in neutral `db::contracts` and narrowing query predicate modules to query-owned behavior.
* Audit footprint: moved 31 DB-internal test files back under `src/db/**`, removed 7 legacy `tests/db/**` stubs, deleted 12 old `src/db/**` files, and removed 6 include-bridge macros.

---

## 0.30.13 - 2026-02-26 - Delete Module Compression and Design Cleanup

### üìù Summary

* This release is an internal structure cleanup focused on simpler ownership and fewer moving parts.
* Removed extra wrapper files and tiny routing modules so related logic now lives in one place.
* Removed compatibility shims and pass-through exports; internal imports now go to the direct source.
* Tightened layer boundaries so lower-level code no longer depends on query-only semantics.
* Consolidated cursor and save-validation internals to avoid split ownership and duplicate roots.
* Moved many DB-internal tests out of production paths into `crates/icydb-core/tests/db/` to reduce noise in `src/db`.
* Updated the `0.31` GROUP BY design docs to be easier to review and follow.

---

## 0.30.12 - 2026-02-26 - Layer Convergence Follow-Up

### üìù Summary

* Continued the DB cleanup by removing overlapping internal ownership and extra wrapper layers.
* Consolidated predicate handling so planning and execution use a single path instead of parallel implementations.
* Moved shared contracts and constants to neutral shared modules to reduce cross-layer coupling.
* Removed leftover thin modules and empty directories that no longer added behavior.
* Kept runtime query behavior unchanged; this release is structural cleanup.

---

## 0.30.11 - 2026-02-26 - DB Cleanup Audit

### üìù Summary

* Completed a broad post-audit cleanup pass across `db/` to simplify ownership and reduce drift.
* Centralized shared cross-layer contracts so execution no longer depends on query-internal details.
* Removed duplicate roots and redundant routing so each concept has one clear home.
* Deleted dead compatibility scaffolding and stale internal helpers that were no longer used.
* Kept query behavior unchanged; this release focuses on structure and maintainability.

---

## 0.30.10 - 2026-02-26 - Commit Boundary Cleanup

### üìù Summary

* Moved commit-row planning ownership out of `db::commit` and into `db::executor`, so commit recovery and apply stay mechanical and boundary-focused.

### üîß Changed

* Moved `prepare_row_commit_for_entity` from `db::commit` to a new executor-owned planner module (`db::executor::commit_planner`).
* Simplified `db::commit::recovery` to marker/replay orchestration and delegated replay/rebuild execution work to executor-owned recovery helpers.
* Removed `db::commit::prepare` and rewired runtime hook registration plus commit-window preflight to use executor-owned planning entry points.
* Added an executor-owned `storage_port` boundary for continuation anchors and range tokens so route/load/cursor modules no longer decode or transform raw index-key bytes inline.
* Kept commit marker shape and runtime behavior stable; this release is a structural ownership refactor.
* Froze the `0.30` architecture layer stack in design docs and made it a mandatory first step in structural audits to reduce layering drift over time.

---

## 0.30.9 - 2026-02-26 - Query Planning Ownership Cleanup

### üìù Summary

* Moved planning setup back to the query layer so `db::executor` can stay focused on execution.

### üîß Changed

* Removed `Query::plan()` from `db::executor` and restored query-owned planning entry points in `db::query::intent` and `db::query::fluent`.
* Kept `db::query` as the single owner of compiling logical plans into `ExecutablePlan`; `db::executor` now only consumes executable plans.
* Added executor-owned `ExecutionPreparation` so predicate/index preparation is done once per plan and reused across load, delete, route, and aggregate paths.
* Simplified execution internals by adding scan adapters, splitting aggregate kernel code into smaller modules, and renaming shared aggregate contracts to `aggregate_model`.
* Clarified validation ownership: executor boundary checks now live in `db::executor`, and access-path shape validation lives in `db::access`.
* No query behavior change is intended in this release; this is a structure and ownership cleanup.

---

## 0.30.8 - 2026-02-26 - Plan Validation Boundary Cleanup

### üìù Summary

* Moved executor plan-contract validation to a neutral `db::plan` boundary so planning and execution no longer depend on query-owned validation wiring.
* Moved shared plan-shape policy rules to `db::policy` so query intent, planner validation, and executor guardrails depend on one neutral policy owner.
* Separated executor cursor-plan error ownership from query `PlanError` by introducing an executor-owned plan error type with explicit boundary mapping.

### üîß Changed

* Added `db::plan::validate::validate_executor_plan` as the shared executor-boundary validation entrypoint.
* Updated executor load/delete/aggregate paths to call the new `db::plan` validator instead of `query::plan::validate`.
* Moved `PlanPolicyError` and cursor paging policy checks from `db::query::policy` to `db::policy`.
* Updated query and executor modules to import policy from `db::policy` instead of query-owned paths.
* Added `ExecutorPlanError` for executor cursor validation and moved conversion to query-owned `PlanError` into `DbSession` boundary handling.
* Moved index-literal byte encoding (`encode_index_literal`) out of `db::access` and into `db::index` so access contracts remain storage-agnostic.
* Kept planning behavior and runtime query results unchanged; this is a layering and ownership cleanup.

---

## 0.30.7 - 2026-02-26 - Plan and Cursor Contract Ownership

### üìù Summary

* Finished a boundary cleanup by moving shared plan and cursor contracts, plus core query domain types, into neutral `db` modules.

### üîß Changed

* Moved shared plan-shape types (`AccessPlannedQuery`, `LogicalPlan`, and order/page/delete specs) into `db::plan::contract`.
* Moved cursor validation error ownership (`CursorPlanError`) into `db::cursor`, while keeping `PlanError` as the query-facing mapping.
* Added neutral modules for `ReadConsistency`, query intent mode (`QueryMode`, `LoadSpec`, `DeleteSpec`), and predicate AST/coercion contracts (`db::consistency`, `db::intent`, `db::predicate`).
* Kept query-layer re-exports in place so existing query call sites continue to compile.
* No query behavior changes were intended in this release.

---

## 0.30.6 - 2026-02-26 - AccessPath Contract Canonicalization

### üìù Summary

* Moved shared query-access types into `db::access` so planning and execution use one source of truth.

### üîß Changed

* Made `db/access/path.rs` the single home for access-path types used by query planning and execution.
* Removed duplicate access type definitions from query plan modules, and updated call sites to use `db::access`.
* Added a planner-facing `PlannedQuery` type so planning and executor compilation are clearly separated.
* Moved pushdown decision types into `db::access`, so executor routing no longer reaches into query validation internals.
* Moved shared value hashing into `db::value_hash`, so query fingerprinting no longer depends on index internals.
* Moved index-predicate program types into `db::access::predicate`, so query and executor share one contract.
* Centralized test memory-id checks and made sure reserved memory id `255` is consistently rejected.
* No query behavior changes were intended in this release; this is a structural cleanup.

---

## 0.30.5 - 2026-02-26 - Cursor Boundary Canonicalization

### üìù Summary

* Moved cursor-boundary types into a neutral `db::cursor` module so continuation state is infrastructure-owned instead of query-owned.

### üîß Changed

* Added canonical `CursorBoundary` and `CursorBoundarySlot` ownership at `db/cursor/boundary.rs`.
* Moved continuation token protocol types (`ContinuationToken`, `ContinuationSignature`, token error, and index-range anchor) under `db/cursor/token.rs`.
* Rewired executor, route planner, query explain helpers, and tests to import cursor primitives from `db::cursor`.
* Removed the now-empty `query::contracts` module after cursor protocol ownership moved to `db::cursor`.
* Kept continuation token wire format and pagination semantics unchanged; this is a structural ownership move only.

---

## 0.30.4 - 2026-02-26 - Direction Canonicalization

### üìù Summary

* Consolidated traversal direction into one shared type so query, executor, and index use the same contract.

### üîß Changed

* Added a canonical `Direction` enum at `db/direction.rs`.
* Removed duplicate `Direction` definitions from query plan and index range modules.
* Rewired imports/re-exports so direction flow no longer depends on query internals in lower runtime layers.
* Kept ordering and continuation behavior unchanged; this is a structural-only refactor.

---

## 0.30.3 - 2026-02-26 - Reducer Dispatch Convergence

### üìù Summary

* Simplified aggregate execution internals so more read paths go through one shared runtime path, while keeping behavior the same.

### üîß Changed

* Removed special streaming dispatch gates so aggregate terminals use one shared kernel reducer path.
* Removed an extra reducer wrapper path and kept structural guard tests aligned with the single-dispatch design.
* Kept `load/aggregate` as wiring-only by moving its last shared alias into the helper module.
* Added structural guard tests for route-planner split boundaries and load trace ownership.
* Added a continuation-cursor stability test to ensure cursor signature and token bytes stay stable for the same query shape.
* Added a strict-vs-subset route-decision golden test to keep aggregate/load routing behavior locked for shared access shapes.

---

## 0.30.2 - 2026-02-25 - Bug Fix

* CI allowed errors through so `make test`, `make patch`, `cargo publish` work but `git push` doesn't.  Fixing.
* Fixed stale invariant-script file paths after executor stream-module refactors so push checks fail on real drift instead of missing moved files.
* Added a shared `make check-invariants` gate and wired it into local `check`/`clippy`/pre-push flows, so invariant drift is caught before `git push`.
* Aligned CI and local invariant coverage and tightened field-projection invariant checks to fail clearly when expected runtime files move.

---

## 0.30.1 - 2026-02-25 - Execution Kernel Consolidation (Phase 2)

### üìù Summary

* Continues the `0.30` cleanup by moving more read execution ownership into the kernel and simplifying module boundaries, with no query behavior changes.

### üîß Changed - Aggregate Execution

* Aggregate execution now runs through one kernel-owned path, including fast-path routing and field-target `MIN`/`MAX` handling.
* Aggregate fast-path orchestration moved out of load-layer helpers into kernel-owned execution, reducing duplicate branching.
* Materialized aggregate reducers for core terminals and field-target extrema are now kernel-owned.
* Streaming aggregate folding continues through one shared kernel reducer runner for `count`, `exists`, `min`, and `max`.
* Unsupported `MIN(field)`/`MAX(field)` targets still fail before any scan-budget work starts.

### üîß Changed - Structure and Naming

* Route planner internals were split into smaller focused modules to reduce hotspot size.
* Stream internals were consolidated under `executor/stream`, with separate `key` and `access` modules.
* Aggregate execution descriptor contracts were moved under shared `executor/aggregate` ownership.
* Load aggregate modules are now thinner wrappers around kernel-owned aggregate execution.
* Internal naming was cleaned up by renaming cursor helpers to `prepare_cursor` and `revalidate_cursor`.
* The internal plan metrics module was renamed to `plan_metrics` for clearer intent.

### üîß Changed - Behavior Notes

* No user-visible query semantics changed; this release is a consolidation pass.

### üß™ Testing

* Reorganized route structural guards into focused test files while keeping the same guard intent.
* Kept structural guard coverage for kernel-owned aggregate dispatch and reducer-runner boundaries.
* Updated guards to keep aggregate preparation and cursor/window progression rooted in kernel-owned helpers.

---

## 0.30.0 - 2026-02-25 - Execution Kernel Consolidation (Phase 1)

### üìù Summary

* Starts `0.30` execution-kernel consolidation by moving shared read behavior into one place while keeping query behavior stable.

### üîß Changed

* Retry for underfilled index-range pages now uses one shared path, so `execute(...)` and `count_distinct_by(...)` stay aligned on fallback behavior and scan counts.
* `DISTINCT` de-duplication and monotonicity validation were consolidated, keeping ascending and descending scans consistent.
* Index-predicate strict-vs-subset branching now goes through one shared helper to reduce routing drift.
* `count_distinct_by(...)` now runs through canonical `execute(...)` orchestration and uses set-based dedupe, improving efficiency without changing results.
* Aggregate streaming setup and fast-path folding now share common preparation helpers, reducing branch-specific setup differences.
* Materialized and routed aggregate branches now use shared resolve-and-fold helpers, removing duplicated orchestration logic.
* Secondary-index aggregate probe and fallback now share one fold helper, keeping retry behavior consistent.
* Aggregate execution now delegates through one `execute_aggregate_spec(...)` boundary with kernel-owned reducer selection.
* Aggregate internals were split into clearer modules (terminals, contracts, orchestration, fast path) to improve maintainability.
* Commit-marker corruption classification and `DISTINCT` comparator setup were simplified for more consistent behavior.

### üß™ Testing

* Expanded parity coverage for `DISTINCT` continuation behavior across ascending/descending index-range and fallback shapes.
* Added regression coverage for `DISTINCT` monotonicity checks in both `ASC` and `DESC`.
* Added structural guard coverage for shared aggregate streaming setup and fast-path folding boundaries.

